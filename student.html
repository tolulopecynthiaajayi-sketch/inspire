<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Portal | Alora Group</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        navy: { primary: '#0A192F', dark: '#020C1B', light: '#112240' },
                        peach: { accent: '#D9654C' }
                    }
                }
            }
        }
    </script>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="./js/firebaseConfig.js"></script>

    <link
        href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Open+Sans:wght@400;600&display=swap"
        rel="stylesheet">
    <style>
        body {
            font-family: 'Open Sans', sans-serif;
            background-color: #F8FAFC;
        }

        h1,
        h2,
        h3,
        h4,
        .nav-link {
            font-family: 'Montserrat', sans-serif;
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <script>
        window.onerror = function (msg, url, lineNo, columnNo, error) {
            alert("CRITICAL ERROR:\n" + msg + "\nLine: " + lineNo);
            console.error(msg, error);
            return false;
        };
    </script>

    <script type="text/babel">
        console.log("DEBUG: student.html SCRIPT START");
        const { useState, useEffect } = React;

        const Icon = ({ name, size = 20, className = "" }) => {
            const iconName = name.charAt(0).toUpperCase() + name.slice(1);
            if (!window.lucide || !window.lucide.icons || !window.lucide.icons[iconName]) return null;
            const iconDef = window.lucide.icons[iconName];
            return (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    {iconDef.map((child, index) => React.createElement(child[0], { ...child[1], key: index }))}
                </svg>
            );
        };

        const NavBar = ({ user }) => (
            <nav className="bg-white shadow-md sticky top-0 z-50">
                <div className="max-w-7xl mx-auto px-4 h-20 flex justify-between items-center">
                    <div className="flex items-center gap-3">
                        <span className="text-xl font-bold text-navy-primary tracking-tight">ALORA<span className="text-peach-accent">STUDENT</span></span>
                    </div>
                    <div className="flex items-center gap-6">
                        <span className="text-sm font-semibold text-gray-600">{user ? user.email : 'Guest'}</span>
                        <button onClick={() => window.auth.signOut().then(() => window.location.href = 'index.html')} className="text-gray-400 hover:text-red-500"><Icon name="logOut" size={20} /></button>
                    </div>
                </div>
            </nav>
        );

        // PLACEHOLDER DASHBOARD
        const Dashboard = () => (
            <div className="max-w-7xl mx-auto px-4 py-12 text-center">
                <div className="bg-white p-10 rounded-lg shadow border border-green-200">
                    <h2 className="text-3xl font-bold text-green-600 mb-4">DEBUG MODE: SUCCESS</h2>
                    <p className="text-gray-600">The script is now running correctly.</p>
                    <p className="text-xs text-gray-400 mt-4">The duplicative Dashboard component has been removed.</p>
                </div>
            </div>
        );

        class ErrorBoundary extends React.Component {
            constructor(props) {
                super(props);
                this.state = { hasError: false, error: null };
            }
            static getDerivedStateFromError(error) { return { hasError: true }; }
            componentDidCatch(error, errorInfo) { this.setState({ error }); console.error(error); }
            render() {
                if (this.state.hasError) return <div className="p-10 text-red-600 font-bold">Something went wrong.</div>;
                return this.props.children;
            }
        }

        const App = () => {
            console.log("DEBUG: App Render");
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                const unsubscribe = window.auth.onAuthStateChanged(u => {
                    setUser(u);
                    setLoading(false);
                });
                return () => unsubscribe();
            }, []);

            if (loading) return <div className="h-screen flex items-center justify-center text-navy-primary">Loading...</div>;

            return (
                <div>
                    <NavBar user={user} />
                    <ErrorBoundary>
                        <Dashboard />
                    </ErrorBoundary>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>